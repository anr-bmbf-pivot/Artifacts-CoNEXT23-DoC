From dccfca9e52b948a1ad61062b5e1955f074eee13c Mon Sep 17 00:00:00 2001
From: Martine Lenders <m.lenders@fu-berlin.de>
Date: Mon, 4 Apr 2022 11:31:39 +0200
Subject: [PATCH] gcoap: add output on client cache hits

---
 sys/net/application_layer/gcoap/gcoap.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/sys/net/application_layer/gcoap/gcoap.c b/sys/net/application_layer/gcoap/gcoap.c
index 0a49e22168..ce67a9fe35 100644
--- a/sys/net/application_layer/gcoap/gcoap.c
+++ b/sys/net/application_layer/gcoap/gcoap.c
@@ -437,6 +437,7 @@ static void _process_coap_pdu(gcoap_socket_t *sock, sock_udp_ep_t *remote,
                         /* update max_age from response and send cached response */
                         uint32_t max_age = 60;
 
+                        ts_printf("V;%u\nC;%u\n", pdu.hdr->id, pdu.hdr->id);
                         coap_opt_get_uint(&pdu, COAP_OPT_MAX_AGE, &max_age);
                         ce->max_age = ztimer_now(ZTIMER_SEC) + max_age;
                         /* copy all options and possible payload from the cached response
@@ -1227,6 +1228,7 @@ static bool _cache_lookup(gcoap_request_memo_t *memo,
         if (*ce &&
             ((*ce)->request_method == coap_get_code(pdu)) &&
             ((*ce)->max_age > now)) {
+            ts_printf("t;%u\nC;%u\n", pdu->hdr->id, pdu->hdr->id);
             return true;
         }
     }
-- 
2.35.1

